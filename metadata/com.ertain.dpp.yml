Categories:
  - Games
License: MIT
AuthorName: Jason Anderson
AuthorEmail: Jason.Anderson@jasonsblog.place
AuthorWebSite: https://www.jasonsblog.place
SourceCode: https://github.com/Ertain/Draw-Ping-Pong
IssueTracker: https://github.com/Ertain/Draw-Ping-Pong/issues
Changelog: https://github.com/Ertain/Draw-Ping-Pong/blob/main/CHANGELOG.md

RepoType: git
Repo: https://github.com/Ertain/Draw-Ping-Pong.git

Builds:
  - versionName: 0.9.1
    versionCode: 2
    commit: 01a941965279130a3c71df64f702db4f172746cf
    sudo:
      - apt-get update || apt-get update
      - apt-get install -y g++ locales llvm clang
      - dpkg-reconfigure locales
    output: output.apk
    srclibs:
      - Godot@3.3.3-stable
    prebuild:
      - mkdir game
      - bash -O extglob -c "mv !(game) game"
      - cp -R $$Godot$$ godot
      - rm godot/misc/dist/ios_xcode/libgodot.iphone.release.fat.a
      - rm godot/misc/dist/ios_xcode/libgodot.iphone.debug.fat.a
      - sed -i -e '/Godot\ user/,+8d' godot/platform/android/java/app/build.gradle
    build:
      - cd godot
      - sed -i "s|valid = false|valid = true|" ./platform/android/export/export.cpp
      - mkdir -p ../fake_user_home/.config/godot/
      - cp ../game/editor_settings-3.tres.f-droid ../fake_user_home/.config/godot/editor_settings-3.tres
      - mkdir -p ../fake_user_home/.android/
      - keytool -genkey -v -keystore ../fake_user_home/.android/debug.keystore -storepass
        android -alias androiddebugkey -keypass android -dname "CN=Android Debug,O=Android,C=US"
      - pushd ../fake_user_home
      - export HOME=$PWD
      - sed -i "s|DEBUG_KEYSTORE|$PWD/.android/debug.keystore|" ./.config/godot/editor_settings-3.tres
      - popd
      - scons -j `nproc` module_webm_enabled=no use_llvm=yes platform=server unix_global_settings_path=".."
      - export ANDROID_NDK_ROOT=$$NDK$$
      - scons -j `nproc` disable_3d=yes platform=android target=release android_arch=arm64v8
      - scons -j `nproc` disable_3d=yes platform=android target=release_debug android_arch=arm64v8
      - pushd platform/android/java/
      - gradle generateGodotTemplates
      - popd
      - mkdir -p ../fake_user_home/.local/share/godot/templates/3.3.3.stable/
      - echo "3.3.3.stable" | tee ../fake_user_home/.local/share/godot/templates/3.3.3.stable/version.txt
      - cp ./bin/android_release.apk ../fake_user_home/.local/share/godot/templates/3.3.3.stable/
      - cp ./bin/android_debug.apk ../fake_user_home/.local/share/godot/templates/3.3.3.stable/
      - cp ./bin/android_source.zip ../fake_user_home/.local/share/godot/templates/3.3.3.stable/
      - cd ../game
      - rm export_presets.cfg
      - mv "export_presets.cfg.f-droid" export_presets.cfg
      # Add in the paths to the custom built Android exports to the "export_presets.cfg" file.
      - sed "s@custom_template/debug=\".*\"@custom_template/debug=\"$HOME/.local/share/godot/templates/3.3.3.stable/android_debug.apk\"@g" -i export_presets.cfg
      - sed "s@custom_template/release=\".*\"@custom_template/release=\"$HOME/.local/share/godot/templates/3.3.3.stable/android_release.apk\"@g" -i export_presets.cfg
      - LANG="en_US.UTF-8" ../godot/bin/godot_server.x11.tools* --verbose --debug --export-debug Android ../output.apk
    ndk: r21e

AutoUpdateMode: None
UpdateCheckMode: None
CurrentVersion: 0.9.1
CurrentVersionCode: 2
