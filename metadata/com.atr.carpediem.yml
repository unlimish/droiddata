Categories:
  - Games
License: 0BSD
AuthorName: Adam T. Ryder
AuthorEmail: tryder@inventati.org
WebSite: https://www.inventati.org/1337gallery/games/carpediem/carpediem.html
SourceCode: https://github.com/ATryder/CarpeDiem
IssueTracker: https://github.com/ATryder/CarpeDiem/issues
Changelog: https://github.com/ATryder/CarpeDiem/releases

AutoName: Carpe Diem

RepoType: git
Repo: https://github.com/ATryder/CarpeDiem.git

Builds:
  - versionName: 1.0.7
    versionCode: 10
    commit: db233c34c02963bcfb0f34590c876f2925a91507
    sudo:
      - apt-get update || apt-get update
      - apt-get install -y g++
    output: carpediem.apk
    srclibs:
      - Godot@3.3.2-stable
    prebuild:
      - mkdir game
      - bash -O extglob -c "mv !(game) game"
      - mv ./.[!.]* game
      - mkdir godot
      - mv $$Godot$$/* godot
      - rm godot/misc/dist/ios_xcode/libgodot.iphone.release.fat.a
      - rm godot/misc/dist/ios_xcode/libgodot.iphone.debug.fat.a
      - sed -i "/String\[] mavenRepos = getGodotPluginsMavenRepos()/,+7 d" ./godot/platform/android/java/app/build.gradle
    build:
      - cd godot
      - sed -i "s|valid = false|valid = true|" ./platform/android/export/export.cpp
      - mkdir -p ../fake_user_home/.config/godot/
      - cp ../game/editor_settings-3.tres ../fake_user_home/.config/godot/
      - mkdir -p ../fake_user_home/.android/
      - pushd ../fake_user_home
      - export HOME=$PWD
      - popd
      - scons -j `nproc` platform=server target=release_debug tools=yes unix_global_settings_path=".."
      - export ANDROID_NDK_ROOT=$$NDK$$
      - scons -j `nproc` platform=android target=release android_arch=armv7
      - pushd platform/android/java/
      - gradle generateGodotTemplates
      - popd
      - mkdir -p ../fake_user_home/.local/share/godot/templates/3.3.2.stable/
      - echo "3.3.2.stable" > ../fake_user_home/.local/share/godot/templates/3.3.2.stable/version.txt
      - mv ./bin/android_release.apk ../fake_user_home/.local/share/godot/templates/3.3.2.stable/
      - mv ./bin/android_source.zip ../fake_user_home/.local/share/godot/templates/3.3.2.stable/
      - cd ../game
      - sed -i "s|architectures/arm64-v8a=true|architectures/arm64-v8a=false|" export_presets.cfg
      - sed -i "s|architectures/x86=true|architectures/x86=false|" export_presets.cfg
      - sed -i "s|architectures/x86_64=true|architectures/x86_64=false|" export_presets.cfg
      - sed -i "s|package/signed=true|package/signed=false|" export_presets.cfg
      - ../godot/bin/godot_server.x11.opt.tools.64 --verbose --export Android ../carpediem.apk
    ndk: r21e

AutoUpdateMode: Version v%v
UpdateCheckMode: Tags
CurrentVersion: 1.0.7
CurrentVersionCode: 10
