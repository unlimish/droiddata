AntiFeatures:
  - NonFreeAssets
Categories:
  - Internet
  - Phone & SMS
License: GPL-3.0-or-later
SourceCode: https://github.com/wireapp/wire-android
IssueTracker: https://github.com/wireapp/wire-android/issues
Changelog: https://github.com/wireapp/wire-android/releases

AutoName: Wire

RepoType: git
Repo: https://github.com/obfusk/wire-android.git

Builds:
  - versionName: 3.72.1009
    versionCode: 1134313
    commit: fdroid
    subdir: app
    gradle:
      - fdroid
    prebuild:
      - cd ..
      - version=$$VERSION$$
      - sed -ri '/fireBase/,/}/d' app/build.gradle
      - sed -ri 's!def patchVersion =.*!def patchVersion = '${version##*.}'!' app/build.gradle
      - sed -ri 's!versionCode getUnixTimestamp\(\) as Integer!versionCode $$VERCODE$$!'
        app/build.gradle
      - wget -O libsodium-1.0.18.tar.gz -- https://github.com/jedisct1/libsodium/releases/download/1.0.18-RELEASE/libsodium-1.0.18.tar.gz
      - printf '17e8638e46d8f6f7d024fe5559eccf2b8baf23e143fadd472a7d29d228b186d86686a5e6920385fe2020729119a5f12f989c3a782afbd05a8db4819bb18666ef  libsodium-1.0.18.tar.gz\n'
        | sha512sum -c
      - tar xzf libsodium-1.0.18.tar.gz
      - cd libsodium-1.0.18
      - for arch in armv7-a armv8-a x86 x86_64; do ./dist-build/android-$arch.sh
      - rm -fr android-toolchain-*; done
      - cd ..
      - mkdir zmessaging/src/main/jni/{arm64-v8a,armeabi-v7a,x86,x86_64}
      - mv libsodium-1.0.18/libsodium-android-armv7-a/lib/libsodium.so zmessaging/src/main/jni/armeabi-v7a/
      - mv libsodium-1.0.18/libsodium-android-armv8-a/lib/libsodium.so zmessaging/src/main/jni/arm64-v8a/
      - mv libsodium-1.0.18/libsodium-android-i686/lib/libsodium.so zmessaging/src/main/jni/x86/
      - mv libsodium-1.0.18/libsodium-android-westmere/lib/libsodium.so zmessaging/src/main/jni/x86_64/
      - rm -fr libsodium-1.0.18.tar.gz libsodium-1.0.18
    scanignore:
      - zmessaging/src/main/jni/armeabi-v7a/libsodium.so
      - zmessaging/src/main/jni/arm64-v8a/libsodium.so
      - zmessaging/src/main/jni/x86/libsodium.so
      - zmessaging/src/main/jni/x86_64/libsodium.so
    scandelete:
      - scripts/custombuild.gradle
    ndk: r20b

MaintainerNotes: |-
    FIXME: uses "wrong" repo
    FIXME: uses branch insted of tag

AutoUpdateMode: None
UpdateCheckMode: None
CurrentVersion: 3.72.1009
CurrentVersionCode: 1134313
