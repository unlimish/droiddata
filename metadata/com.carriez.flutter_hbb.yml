Categories:
  - System
License: GPL-3.0-only
WebSite: https://rustdesk.com
SourceCode: https://github.com/rustdesk/rustdesk
IssueTracker: https://github.com/rustdesk/rustdesk/issues
Changelog: https://github.com/rustdesk/rustdesk/releases

RepoType: git
Repo: https://github.com/rustdesk/rustdesk

Builds:
  - versionName: 1.1.10
    versionCode: 27
    commit: d7aac263567a47d9a24a50f8c2321cbd2b701058
    subdir: flutter
    sudo:
      - apt-get update || apt-get update
      - apt-get install -y openjdk-11-jdk-headless
      - update-alternatives --auto java
      - apt-get install -y libclang-7-dev clang-7 gcc-multilib g++-multilib cmake
    output: build/app/outputs/flutter-apk/app-release.apk
    srclibs:
      - flutter@2.10.5
      - rustup@1.24.3
      - oboe@1.6.1
      - opus@v1.3
      - libvpx@v1.11.0
      - atalk@2.9.4
    rm:
      - flutter/ios
      - flutter/test
      - flutter/web
    prebuild:
      - sed -i -e '/gms/d' android/build.gradle android/app/build.gradle
      - sed -i -e '/firebase_analytics/d' pubspec.yaml
      - sed -i -e '/  firebase/,/    version/d' pubspec.lock
      - sed -i -e '/firebase/Id' -e '/await b/d' lib/main.dart
      - JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64 $$SDK$$/tools/bin/sdkmanager 'ndk;18.1.5063045'
        > /dev/null
      - sed -i -e '/libyuv/d' ../libs/scrap/build.rs
    build:
      - cd ..
      - export ANDROID_NDK=/opt/android-sdk/ndk/18.1.5063045
      - export VCPKG_ROOT=$(pwd)/vcpkg
      - export PREFIX=$VCPKG_ROOT/installed/arm64-android
      - pushd $$atalk$$/aTalk/jni/static_library_built/libvpx
      - sed -i -e '/android-ndk-r18b/d' -e 's/"armeabi-v7a" "arm64-v8a" "x86" "x86_64"/"arm64-v8a"/'
        -e '/  PREFIX/d' _settings.sh
      - sed -i -e "s|  PREFIX=.*|  PREFIX=$PREFIX|" -e '/init_libvpx/d' build-vpx4android.sh
      - ln -s $$libvpx$$ libvpx
      - ./build-vpx4android.sh
      - popd
      - export ANDROID_NDK=$$NDK$$
      - export PATH=$ANDROID_NDK/toolchains/llvm/prebuilt/linux-x86_64/bin/:$PATH
      - patch -d $$oboe$$ -p1 < src/oboe.patch
      - pushd $$oboe$$
      - cmake -DBUILD_SHARED_LIBS=true -DCMAKE_BUILD_TYPE=RelWithDebInfo -DANDROID_TOOLCHAIN=clang
        -DANDROID_STL=c++_shared -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK/build/cmake/android.toolchain.cmake
        -DCMAKE_INSTALL_PREFIX=$PREFIX -DANDROID_ABI=arm64-v8a -DANDROID_PLATFORM=android-21
        .
      - make -j$(nproc)
      - make install
      - popd
      - mv $PREFIX/lib/arm64-v8a/liboboe.a $PREFIX/lib
      - pushd $$opus$$
      - ./autogen.sh
      - CC=aarch64-linux-android21-clang   ./configure --host=aarch64-linux-android
        --with-pic --disable-extra-programs --disable-doc --prefix=$PREFIX
      - make opus -j$(nproc)
      - make install
      - popd
      - $$rustup$$/rustup-init.sh -y
      - source $HOME/.cargo/env
      - rustup install 1.60.0
      - rustup target add aarch64-linux-android x86_64-linux-android
      - cargo install cargo-ndk
      - LIBCLANG_PATH=/usr/lib/llvm-7/lib/ cargo ndk --platform 21 --target aarch64-linux-android
        -o flutter/android/app/src/main/jniLibs build --release
      - cd flutter
      - aarch64-linux-android-strip android/app/src/main/jniLibs/arm64-v8a/*
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter packages pub get
      - $$flutter$$/bin/flutter build apk --target-platform android-arm64 --release
    ndk: r22b

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: flutter/pubspec.yaml|version:\s.+\+(\d+)|.|version:\s(.+)\+
CurrentVersion: 1.1.10
CurrentVersionCode: 27
