Categories:
  - Internet
License: MIT
WebSite: https://cwtch.im
SourceCode: https://git.openprivacy.ca/cwtch.im/cwtch-ui
IssueTracker: https://git.openprivacy.ca/cwtch.im/cwtch-ui/issues
Changelog: https://cwtch.im/changelog/
Donate: https://openprivacy.ca/donate/

AutoName: Cwtch
Summary: Metadata resistant privacy platform designed to help you resist surveillance
Description: |-
    Cwtch (/kʊtʃ/ - a Welsh word roughly translating to “a hug that creates a safe place”) is a decentralized, privacy-preserving, multi-party messaging protocol that can be used to build metadata resistant applications.

    Decentralized and Open: There is no “Cwtch service” or “Cwtch network”. Participants in Cwtch can host their own safe spaces, or lend their infrastructure to others seeking a safe space. The Cwtch protocol is open, and anyone is free to build bots, services and user interfaces and integrate and interact with Cwtch.

    Privacy Preserving: All communication in Cwtch is end-to-end encrypted and takes place over Tor v3 onion services.

    Metadata Resistant: Cwtch has been designed such that no information is exchanged or available to anyone without their explicit consent, including on-the-wire messages and protocol metadata.

RepoType: git
Repo: https://git.openprivacy.ca/cwtch.im/cwtch-ui.git

Builds:
  - versionName: 1.8.0
    versionCode: 30
    commit: 4404977128fb62b2978f4a5f94bbc22af28bf80e
    sudo:
      - apt-get update || apt-get update
      - apt-get install -y autogen build-essential gcc-arm-linux-gnueabihf libevent-dev
        openjdk-11-jdk-headless
      - update-alternatives --auto java
    output: build/app/outputs/apk/release/app-release-unsigned.apk
    srclibs:
      - flutter@3.0.5
      - libcwtch-go@v1.8.0
      - tor-android@0.4.6.9
    prebuild:
      - sed -i -e '/InvalidPackage/aabortOnError false' android/app/build.gradle
      - sed -i -e 's/3.5.4/4.0.1/' android/build.gradle
      - echo `git describe --tags --abbrev=1` > VERSION
      - echo `date +%G-%m-%d-%H-%M` > BUILDDATE
      - pushd $$tor-android$$
      - sed -i -e  "/$1 = 'debug/,+4d" tor-droid-make.sh
      - ./tor-droid-make.sh fetch
      - popd
      - mkdir -p android/app/src/main/jniLibs/{arm64-v8a,armeabi-v7a,x86,x86_64}
    scandelete:
      - integration_test
    build:
      - pushd $$tor-android$$
      - ./tor-droid-make.sh build -b release
      - popd
      - cp $$tor-android$$/external/lib/arm64-v8a/libtor.so android/app/src/main/jniLibs/arm64-v8a/
      - cp $$tor-android$$/external/lib/x86_64/libtor.so android/app/src/main/jniLibs/x86_64/
      - cp $$tor-android$$/external/lib/armeabi-v7a/libtor.so android/app/src/main/jniLibs/armeabi-v7a/
      - cp $$tor-android$$/external/lib/x86/libtor.so android/app/src/main/jniLibs/x86/
      - pushd $$libcwtch-go$$
      - curl -Lso go.tar.gz https://golang.org/dl/go1.17.4.linux-amd64.tar.gz
      - echo "adab2483f644e2f8a10ae93122f0018cef525ca48d0b8764dae87cb5f4fd4206 go.tar.gz"
        | sha256sum -c -
      - tar xzf go.tar.gz
      - export GOPATH="$PWD/golang"
      - export GOPROXY=direct
      - export PATH="$GOPATH/bin:$PWD/go/bin:$PATH"
      - export ANDROID_NDK_HOME=$$NDK$$
      - go install golang.org/x/mobile/cmd/gomobile@4e6c2922fdeed32d3596616518aaee7b0d79ce55
      - go get cwtch.im/cwtch@v0.16.8
      - go get git.openprivacy.ca/cwtch.im/server@v1.4.4
      - go get github.com/mutecomm/go-sqlcipher/v4@v4.4.2
      - go get golang.org/x/text@v0.3.7
      - ./switch-gomobile.sh
      - gomobile init
      - gomobile bind -target android -ldflags="-X cwtch.buildVer=$(git describe --tags)
        -X cwtch.buildDate=$(date +%G-%m-%d-%H-%M)"
      - popd
      - mv $$libcwtch-go$$/cwtch.aar android/cwtch/
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter packages pub get
      - $$flutter$$/bin/flutter build apk --dart-define BUILD_VER=`cat VERSION` --dart-define
        BUILD_DATE=`cat BUILDDATE`
    ndk: r21e

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: pubspec.yaml|version:\s.*\+(\d+)|.|version:\s(.*)\+
CurrentVersion: 1.8.0
CurrentVersionCode: 30
