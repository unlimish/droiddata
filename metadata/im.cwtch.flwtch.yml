Categories:
  - Internet
License: MIT
WebSite: https://cwtch.im
SourceCode: https://git.openprivacy.ca/cwtch.im/cwtch-ui
IssueTracker: https://git.openprivacy.ca/cwtch.im/cwtch-ui/issues
Changelog: https://cwtch.im/changelog/
Donate: https://openprivacy.ca/donate/

AutoName: Cwtch
Description: Metadata Resistant Chat

RepoType: git
Repo: https://git.openprivacy.ca/cwtch.im/cwtch-ui.git

Builds:
  - versionName: 1.7.1
    versionCode: 29
    commit: fa52b741bf5c540974de526dd0300aeeff0eed95
    output: build/app/outputs/apk/release/app-release-unsigned.apk
    srclibs:
      - flutter@stable
      - libcwtch-go@1.7.1
    prebuild:
      - sed -i -e '/InvalidPackage/aabortOnError false' android/app/build.gradle
      - sed -i -e 's/1.3.50/1.6.21/' -e 's/3.5.4/4.0.1/' android/build.gradle
      - sed -i -e 's/5.6.2/6.1.1/' android/gradle/wrapper/gradle-wrapper.properties
    scandelete:
      - integration_test
    build:
      - pushd $$libcwtch-go$$
      - curl -Lso go.tar.gz https://golang.org/dl/go1.17.4.linux-amd64.tar.gz
      - echo "adab2483f644e2f8a10ae93122f0018cef525ca48d0b8764dae87cb5f4fd4206 go.tar.gz"
        | sha256sum -c -
      - tar xzf go.tar.gz
      - export GOPATH="$PWD/golang"
      - export PATH="$GOPATH/bin:$PWD/go/bin:$PATH"
      - export ANDROID_NDK_HOME=$$NDK$$
      - go install golang.org/x/mobile/cmd/gomobile@4e6c2922fdeed32d3596616518aaee7b0d79ce55
      - ./switch-gomobile.sh
      - gomobile init
      - gomobile bind -target android -ldflags="-X cwtch.buildVer=$(git describe --tags)
        -X cwtch.buildDate=$(date +%G-%m-%d-%H-%M)"
      - popd
      - mv $$libcwtch-go$$/cwtch.aar android/cwtch/
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter packages pub get
      - $$flutter$$/bin/flutter build apk
    ndk: r22b

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: pubspec.yaml|version:\s.*\+(\d+)|.|version:\s(.*)\+
CurrentVersion: 1.7.1
CurrentVersionCode: 29
