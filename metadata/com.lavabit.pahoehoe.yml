Categories:
  - Internet
  - Security
License: GPL-3.0-only
AuthorName: Lavabit LLC
WebSite: https://lavabit.com
SourceCode: https://github.com/lavabit/pahoehoe
IssueTracker: https://github.com/lavabit/pahoehoe/issues
Changelog: https://github.com/lavabit/pahoehoe/releases/tag/1.0.0

AutoName: Lavabit Encrypted Proxy

RepoType: git
Repo: https://github.com/lavabit/pahoehoe.git

Builds:
  - versionName: 1.0.0
    versionCode: 200
    commit: 1.0.0
    subdir: android/app
    gradle:
      - lavabitProductionFatRelease
    rm:
      - vpnweb/
      - daemon/
      - desktop/
      - android/gradle/wrapper/gradle-wrapper.jar
      - android/ics-openvpn/gradle/wrapper/gradle-wrapper.jar
    prebuild:
      - sed -i -e "/^task updateSdkLicences/,/^}/d; /commandLine 'git'/d" build.gradle
      - yes | $ANDROID_HOME/tools/bin/sdkmanager --licenses
      - $ANDROID_HOME/tools/bin/sdkmanager 'platforms;android-30' > /dev/null
      - $ANDROID_HOME/tools/bin/sdkmanager 'build-tools;30.0.3' > /dev/null
      - $ANDROID_HOME/tools/bin/sdkmanager 'ndk;21.4.7075529' > /dev/null
      - $ANDROID_HOME/tools/bin/sdkmanager 'cmake;3.10.2.4988404' > /dev/null
    scandelete:
      - android/go/
      - android/ics-openvpn/
    build:
      - export ANDROID_NDK_ROOT="$ANDROID_NDK"
      - cd ../go
      - curl -o go.tar.gz https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz
      - echo '6272d6e940ecb71ea5636ddb5fab3933e087c1356173c61f4a803895e947ebb3  go.tar.gz'
        | shasum -c
      - mkdir -p golang
      - tar -C golang -xzf go.tar.gz
      - export GOPATH="$PWD"
      - export GO_LANG="$PWD/golang/go/bin"
      - export GO_COMPILED="$PWD/bin"
      - export PATH="$GO_LANG:$GO_COMPILED:$PATH"
      - ./golang/go/bin/go get golang.org/x/mobile/cmd/gomobile
      - ./bin/gomobile init
      - ./android_build_web_core.sh
      - ./android_build_core.sh
      - cd ../ics-openvpn
      - gradle main:externalNativeBuildCleanSkeletonRelease main:externalNativeBuildSkeletonRelease
    ndk: r21e

AutoUpdateMode: Version %v
UpdateCheckMode: Tags ^[0-9]+\.[0-9]+\.[0-9]+$
CurrentVersion: 1.0.0
CurrentVersionCode: 200
