AntiFeatures:
  - NonFreeNet
Categories:
  - Navigation
License: GPL-3.0-only
AuthorName: OPENER next
AuthorEmail: openernext@etit.tu-chemnitz.de
AuthorWebSite: https://openernext.de
WebSite: https://openstop.app
SourceCode: https://github.com/OPENER-next/OpenStop
IssueTracker: https://github.com/OPENER-next/OpenStop/issues
Changelog: https://github.com/OPENER-next/OpenStop/releases

AutoName: OpenStop

RepoType: git
Repo: https://github.com/OPENER-next/OpenStop.git
Binaries: https://github.com/OPENER-next/OpenStop/releases/download/v%v/OpenStop_fdroid_v%v.apk

Builds:
  - versionName: 0.4.4
    versionCode: 14
    commit: v0.4.4
    sudo:
      - apt-get update
      - apt-get install -y jq python3-pip
      - pip3 install yq
      - mkdir -p /home/runner/
      - chown vagrant /home/runner/
    output: build/app/outputs/flutter-apk/app-release.apk
    srclibs:
      - flutter@stable
    rm:
      - ios
      - web
      - .github
    prebuild:
      - "$(yq -y -i '.dependency_overrides.geolocator_android.git = {\"url\": \"https://github.com/Zverik/flutter-geolocator.git\"\
        , \"ref\": \"floss\", \"path\": \"geolocator_android\"}' pubspec.yaml)"
      - mkdir -p /home/runner/work/OpenStop/
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - export version="$(yq -r .environment.flutter pubspec.yaml)"
      - pushd $$flutter$$
      - git checkout -f $version
      - popd
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter pub get
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop
    scandelete:
      - .pub-cache
    build:
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - $$flutter$$/bin/flutter pub run build_runner build --delete-conflicting-outputs
      - $$flutter$$/bin/flutter build apk --dart-define=THUNDERFOREST_API_KEY=4dcc69df496b49b9b90886ba0a8ee31c
        --dart-define=IS_RELEASE=true
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop

  - versionName: 0.5.0
    versionCode: 15
    commit: 1f709503e6e39c5fd26419a3b2a86c0a4faf603d
    sudo:
      - apt-get update
      - apt-get install -y jq python3-pip
      - pip3 install yq
      - mkdir -p /home/runner/
      - chown vagrant /home/runner/
    output: build/app/outputs/flutter-apk/app-release.apk
    srclibs:
      - flutter@stable
    rm:
      - ios
      - web
      - .github
    prebuild:
      - "$(yq -y -i '.dependency_overrides.geolocator_android.git = {\"url\": \"https://github.com/Zverik/flutter-geolocator.git\"\
        , \"ref\": \"floss\", \"path\": \"geolocator_android\"}' pubspec.yaml)"
      - mkdir -p /home/runner/work/OpenStop/
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - export version="$(yq -r .environment.flutter pubspec.yaml)"
      - pushd $$flutter$$
      - git checkout -f $version
      - popd
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter pub get
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop
    scandelete:
      - .pub-cache
    build:
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - $$flutter$$/bin/flutter pub run build_runner build --delete-conflicting-outputs
      - $$flutter$$/bin/flutter build apk --dart-define=THUNDERFOREST_API_KEY=4dcc69df496b49b9b90886ba0a8ee31c
        --dart-define=IS_RELEASE=true
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop

  - versionName: 0.6.0
    versionCode: 16
    disable: https://github.com/OPENER-next/OpenStop/issues/224
    commit: 245b59d3c70a570e24f4c6617e5f097d837f22a3
    sudo:
      - apt-get update
      - apt-get install -y jq python3-pip
      - pip3 install yq
      - mkdir -p /home/runner/
      - chown vagrant /home/runner/
    output: build/app/outputs/flutter-apk/app-release.apk
    srclibs:
      - flutter@stable
    rm:
      - ios
      - web
      - .github
    prebuild:
      - "$(yq -y -i '.dependency_overrides.geolocator_android.git = {\"url\": \"https://github.com/Zverik/flutter-geolocator.git\"\
        , \"ref\": \"floss\", \"path\": \"geolocator_android\"}' pubspec.yaml)"
      - mkdir -p /home/runner/work/OpenStop/
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - export version="$(yq -r .environment.flutter pubspec.yaml)"
      - pushd $$flutter$$
      - git checkout -f $version
      - popd
      - $$flutter$$/bin/flutter config --no-analytics
      - $$flutter$$/bin/flutter pub get
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop
    scandelete:
      - .pub-cache
    build:
      - cd ..
      - mv de.tu_chemnitz.etit.sse.openstop /home/runner/work/OpenStop/OpenStop
      - export HOME=/home/runner
      - pushd $HOME/work/OpenStop/OpenStop/
      - export PUB_CACHE=$(pwd)/.pub-cache
      - $$flutter$$/bin/flutter pub run build_runner build --delete-conflicting-outputs
      - $$flutter$$/bin/flutter build apk --dart-define=THUNDERFOREST_API_KEY=4dcc69df496b49b9b90886ba0a8ee31c
        --dart-define=IS_RELEASE=true
      - popd
      - mv $HOME/work/OpenStop/OpenStop de.tu_chemnitz.etit.sse.openstop

AllowedAPKSigningKeys: 0442746b76b1e5fcf1ef6eaabc03ddf99ad756b622179b75b72e7cd78fc57de9

AutoUpdateMode: Version
UpdateCheckMode: Tags
UpdateCheckData: pubspec.yaml|version:\s.+\+(\d+)|.|version:\s(.+)\+
CurrentVersion: 0.6.0
CurrentVersionCode: 16
